These are some personal bash scripts I use for querying the [National Vulnerability Database's API](https://nvd.nist.gov/developers).
They assist with finding CPEs, CVEs, and creating an sqlite database to track CVEs
These functions can be used by a cronjob/systemd.timer to stay alert to newly released vulnerabilities on observed systems. 
NOTE: If setting up automated requests on a list of products, when making more than 10 requests per minute an API key should be used. See the NVD's [section on rate limiting](https://nvd.nist.gov/developers).
API keys can be set with the `API_KEY` environment variable (request a key [here](https://nvd.nist.gov/developers/request-an-api-key)). 


## cpe_find.sh 
Queries the NVD's (National Vulnerability Database) API to retrieve possible [CPEs](https://nvd.nist.gov/products/cpe) (Common Platform Enumerations) for a product/software/platform.


How to use:
```shell
./cpe_find.sh [OPTION]... PROGRAM [VERSION]

optional arguments:

 -h 		print help
 -i 		interactive mode: show info on query results, select results to append cpes to the outfile
 -m 		minimal, non-interactive mode: returns all cpe's matching query (up to 20 results)
 -o file 	override hardcoded output file to which selected CPE(s) will be appended
```
example: `cpe_find.sh -io outfile.txt rsync 3.2.5`

#### can run in 2 modes:

- Minimal mode (default) will only output a list of returned cpes to stdout (one per line).

- Interactive mode can will present info on each returned cpe and let you pick which to append to the specified file (either hardcoded in `$outfile` or set with the `-o <outfile>` flag).
	

For both modes, the API will return a max 20 results, specify software versions for better results. 	

![gif demo](https://github.com/au70p0i3sis/bash_cve-tracking/blob/main/gifs/cpe_find.gif)

## cve_query.sh
 Queries the National Vulnerability Database's Api to retrieve
 a list of cve's for a given CPE (v2.3)

How to use:
```shell
 ./cve_query.sh [OPTION]... CPE

Options:
 -a INT		set age range in days (120 is the default and max accepted by api)
 -d			output to sqlite database (hardcoded in script)
 -h 		print help
 -j 		output in filtered json (default: human readable)
 -r			run query and return raw json result, no parsing or filtering
 ```

#### example:

retrieve cves published in the last 30 days and output into database

```shell
export API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
cve_query.sh -a 30 -d "cpe:2.3:a:apache:log4j:2.0:-:*:*:*:*:*:*"
```

## db_manage.sh
A few simple helper functions to query the local sqlite database of tracked cves (if in use, see cve_query.sh)

usage:  
`db_manage.sh COMMAND TERM`

### commands: 
 * search_program PROGRAM
 * search_cve CVE
 * search_cpe CPE

## API KEY 

The public rate limit (without an API key) is 10 requests in a rolling 60 second window; the rate limit with an API key is 100 requests in a rolling 60 second window.
API keys can be set with the `API_KEY` environment variable. 
